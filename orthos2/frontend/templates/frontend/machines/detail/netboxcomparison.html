{% extends 'frontend/machines/machine.html' %}
{% load filters %}

{% block tabcontent %}
<div style="display: table; width: 100%;">
<div style="display: table-row;" class="float-right">
  <a class="text-right btn btn-secondary btn-sm" href="{% url 'frontend:netbox_compare' machine.id %}" role="button">Preview and Compare data with NetBox</a>
</div>
</div>

<div class="title">
  <h5>Machine - UUID {{ machine_run.run_id }}</h5>
</div>

<p>Most recent Machine update: {{ machine.netbox_last_fetch_attempt }}</p>
<p>Data fetched at: {{ machine_run.compare_timestamp }}</p>

<table class="table table-bordered small table-hover">
  <thead class="thead-default">
    <th>Property Name</th>
    <th>Orthos</th>
    <th>NetBox</th>
    <th>Is data equal?</th>
  </thead>
  <tbody>
    {% for result in machine_run.results.all %}
    <tr class="clickable-row" data-href="#{{ result.id }}">
        <td>{{ result.property_name }}</td>
        <td>{{ result.orthos_result|format_empty_str }}</td>
        <td>{{ result.netbox_result|format_empty_str }}</td>
        {% if result.orthos_result == result.netbox_result %}
        <td>&#9989;</td>
        {% else %}
        <td>&#10005;</td>
        {% endif %}
    </tr>
    {% endfor %}
  </tbody>
</table>

{% if machine.has_bmc %}
<div class="title">
  <h5>BMC - UUID {{ bmc_run.run_id }}</h5>
</div>

<p>Most recent BMC update: {{ machine.bmc.netbox_last_fetch_attempt }}</p>
<p>Data fetched at: {{ bmc_run.compare_timestamp }}</p>

<table class="table table-bordered small table-hover">
  <thead class="thead-default">
    <th>Property Name</th>
    <th>Orthos</th>
    <th>NetBox</th>
    <th>Is data equal?</th>
  </thead>
  <tbody>
    {% for result in bmc_run.results.all %}
    <tr class="clickable-row" data-href="#{{ result.id }}">
        <td>{{ result.property_name }}</td>
        <td>{{ result.orthos_result|format_empty_str }}</td>
        <td>{{ result.netbox_result|format_empty_str }}</td>
        {% if result.orthos_result == result.netbox_result %}
        <td>&#9989;</td>
        {% else %}
        <td>&#10005;</td>
        {% endif %}
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endif %}

<div class="title">
  <h5>Network Interfaces</h5>
</div>

{% for intf in machine.networkinterfaces.all %}
{% with network_interface_run_intf=network_interface_run|get_netbox_comparison_result:intf.name %}
<div class="title">
  <h6>Network Interface {{ intf.name }} - UUID {{ network_interface_run_intf.run_id }}</h6>
</div>

<p>Most recent Interface update: {{ intf.netbox_last_fetch_attempt }}</p>
<p>Data fetched at: {{ network_interface_run_intf.compare_timestamp }}</p>

<table class="table table-bordered small table-hover">
  <thead class="thead-default">
    <th>Property Name</th>
    <th>Orthos</th>
    <th>NetBox</th>
    <th>Is data equal?</th>
  </thead>
  <tbody>
    {% for result in network_interface_run_intf.results.all %}
    <tr class="clickable-row" data-href="#{{ result.id }}">
        <td>{{ result.property_name }}</td>
        <td>{{ result.orthos_result|format_empty_str }}</td>
        <td>{{ result.netbox_result|format_empty_str }}</td>
        {% if result.orthos_result == result.netbox_result %}
        <td>&#9989;</td>
        {% else %}
        <td>&#10005;</td>
        {% endif %}
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endwith %}
{% endfor %}

{% endblock %}
